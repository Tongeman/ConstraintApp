<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Constraint Quiz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 20px;
        }
        
        .intro {
            padding: 40px;
            line-height: 1.8;
            color: #333;
        }
        
        .intro p {
            margin-bottom: 20px;
        }
        
        .intro ul {
            list-style: none;
            margin: 20px 0;
        }
        
        .intro li {
            padding: 8px 0;
            padding-left: 30px;
            position: relative;
        }
        
        .intro li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: bold;
            font-size: 18px;
        }
        
        .content {
            padding: 40px;
        }
        
        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }
            .intro {
                padding: 20px;
            }
            .header {
                padding: 30px 20px;
            }
            .header h1 {
                font-size: 24px;
            }
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            width: 0%;
        }
        
        .progress-text {
            text-align: center;
            color: #666;
            margin-bottom: 25px;
            font-size: 14px;
        }
        
        .question-container {
            display: none;
            animation: fadeIn 0.4s;
        }
        
        .question-container.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .question-introduction {
            font-size: 18px;
			font-weight: 600;
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9ff;
            border-left: 3px solid #667eea;
            border-radius: 4px;
        }
        
        @media (max-width: 768px) {
            .question-introduction {
                font-size: 14px;
                padding: 12px;
                margin-bottom: 15px;
            }
        }
        
        .question-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 25px;
            line-height: 1.4;
        }
        
        @media (max-width: 768px) {
            .question-title {
                font-size: 18px;
                margin-bottom: 20px;
            }
        }
        
        .answer-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .answer-btn {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            font-size: 15px;
            line-height: 1.5;
            color: #555;
            display: flex;
            align-items: flex-start;
        }
        
        @media (max-width: 768px) {
            .answer-btn {
                padding: 14px 16px;
                font-size: 14px;
            }
        }
        
        .answer-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateX(5px);
        }
        
        .answer-btn:active {
            transform: translateX(5px) scale(0.98);
        }
        
        .answer-btn.selected {
            border-color: #667eea;
            background: #f8f9ff;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }
        
        .answer-number {
            font-weight: 600;
            color: #667eea;
            margin-right: 12px;
            flex-shrink: 0;
            min-width: 20px;
        }
        
        .answer-text {
            flex: 1;
        }
        
        .btn-container {
            display: flex;
            gap: 12px;
            margin-top: 30px;
        }
        
        @media (max-width: 768px) {
            .btn-container {
                margin-top: 20px;
                gap: 10px;
            }
        }
        
        .btn {
            flex: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        @media (max-width: 768px) {
            .btn {
                padding: 12px 20px;
                font-size: 15px;
            }
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn:active:not(:disabled) {
            transform: translateY(0);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover:not(:disabled) {
            box-shadow: 0 10px 20px rgba(108, 117, 125, 0.3);
        }
        
        .hidden {
            display: none;
        }
        
        .email-form {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        
        .form-group input[type="text"],
        .form-group input[type="email"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .results {
            animation: fadeIn 0.5s;
        }
        
        .results h2 {
            color: #667eea;
            font-size: 28px;
            margin-bottom: 20px;
        }
        
        .results h3 {
            color: #667eea;
            font-size: 22px;
            margin-top: 30px;
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .results h2 {
                font-size: 24px;
            }
            .results h3 {
                font-size: 20px;
            }
        }
        
        .constraint-highlight {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .constraint-highlight h3 {
            color: #856404;
            margin-top: 0;
        }
        
        .score-summary {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .score-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .score-item:last-child {
            border-bottom: none;
        }
        
        .score-label {
            color: #555;
        }
        
        .score-value {
            font-weight: 600;
            color: #667eea;
        }
        
        .recommendations {
            line-height: 1.8;
            color: #555;
        }
        
        .recommendations p {
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Find Your Business Growth Constraint</h1>
        </div>
        
        <!-- Introduction Screen -->
        <div id="introScreen" class="intro">
            <p>Every business typically has a single constraint limiting its growth. If you want to scale, you have to find and resolve that constraint.</p>
            
            <p>Most CEOs waste resources improving areas that don't actually matter while the real bottleneck quietly chokes their progress. This quick quiz will help you identify exactly where your growth is stuck, so you can focus your efforts where they'll actually make a difference.</p>
            
            <ul>
                <li>Takes less than 5 minutes to complete</li>
                <li>Get instant, actionable insights specific to your business</li>
                <li>Identify your #1 constraint with precision</li>
                <li>Discover exactly where to focus for maximum growth impact</li>
            </ul>
            
            <button class="btn" onclick="startQuiz()" style="margin-top: 30px; width: 100%;">Start the Quiz</button>
        </div>
        
        <!-- Quiz Questions -->
        <div id="quizScreen" class="content hidden">
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
            <div class="progress-text" id="progressText">Question 1 of 9</div>
            
            <div id="questionsContainer"></div>
            
            <div class="btn-container">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()" disabled>Previous</button>
                <button class="btn" id="nextBtn" onclick="nextQuestion()" disabled>Next</button>
            </div>
        </div>
        
        <!-- Email Capture -->
        <div id="emailScreen" class="content hidden">
            <div class="email-form">
                <h2 style="text-align: center; color: #667eea; margin-bottom: 20px;">Almost There!</h2>
                <p style="text-align: center; margin-bottom: 30px; color: #555;">Enter your details to see your personalized results</p>
                
                <form id="emailForm" onsubmit="submitEmail(event)">
                    <div class="form-group">
                        <label for="userName">Name</label>
                        <input type="text" id="userName" required>
                    </div>
    
                    <div class="form-group">
                        <label for="userEmail">Email</label>
                        <input type="email" id="userEmail" required>
                    </div>
    
                    <div class="form-group" style="display: flex; align-items: start; gap: 10px;">
                        <input type="checkbox" id="emailConsent" required style="margin-top: 4px; width: auto; flex-shrink: 0;">
                        <label for="emailConsent" style="margin: 0; font-weight: normal; line-height: 1.5;">
                            I agree to receive my quiz results and helpful emails about growing my business. You can unsubscribe at any time.
                        </label>
                    </div>
    
                    <button type="submit" class="btn" style="width: 100%;">View My Results</button>
                </form>
            </div>
        </div>
        
        <!-- Results Screen -->
        <div id="resultsScreen" class="content hidden">
            <div class="results">
                <h2>Your Business Constraint Analysis</h2>
                
                <div class="constraint-highlight">
                    <h3 id="primaryConstraint"></h3>
                    <p id="constraintDescription"></p>
                </div>
                
                <h3>Your Scores</h3>
                <div class="score-summary" id="scoresSummary"></div>
                
                <h3>Recommendations</h3>
                <div class="recommendations" id="recommendationsText"></div>
                
                <button class="btn" onclick="resetQuiz()" style="margin-top: 30px; width: 100%;">Take Quiz Again</button>
            </div>
        </div>
    </div>
    
    <script src="quiz-data.js"></script>
    <script>
        const questions = quizConfig.questions;
        
        let currentQuestion = 0;
        let answers = {};
        let userData = {};
        
        function startQuiz() {
            document.getElementById('introScreen').classList.add('hidden');
            document.getElementById('quizScreen').classList.remove('hidden');
            renderQuestions();
            showQuestion(0);
        }
        
        function renderQuestions() {
            const container = document.getElementById('questionsContainer');
            
            questions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-container';
                questionDiv.id = `question-${index}`;
                
                let optionsHtml = '';
                q.options.forEach((option) => {
                    optionsHtml += `
                        <button type="button" class="answer-btn" data-question="${index}" data-value="${option.value}" onclick="selectAnswer(${index}, ${option.value})">
                            <span class="answer-number">${option.value}.</span>
                            <span class="answer-text">${option.text}</span>
                        </button>
                    `;
                });
                
                questionDiv.innerHTML = `
                    ${q.introduction ? `<div class="question-introduction">${q.introduction}</div>` : ''}
                    <div class="question-title">${q.title}</div>
                    <div class="answer-buttons">
                        ${optionsHtml}
                    </div>
                `;
                
                container.appendChild(questionDiv);
            });
        }
        
        function showQuestion(index) {
            document.querySelectorAll('.question-container').forEach(q => q.classList.remove('active'));
            document.getElementById(`question-${index}`).classList.add('active');
            
            currentQuestion = index;
            updateProgress();
            updateButtons();
        }
        
        function selectAnswer(questionIndex, value) {
            answers[questions[questionIndex].id] = value;
            
            // Update visual selection
            document.querySelectorAll(`[data-question="${questionIndex}"]`).forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector(`[data-question="${questionIndex}"][data-value="${value}"]`).classList.add('selected');
            
            updateButtons();
            
            // Auto-advance to next question after short delay (optional - remove if you don't want this)
            setTimeout(() => {
                if (currentQuestion < questions.length - 1) {
                    nextQuestion();
                }
            }, 500);
        }
        
        function updateProgress() {
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = `Question ${currentQuestion + 1} of ${questions.length}`;
        }
        
        function updateButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.disabled = currentQuestion === 0;
            
            const currentAnswered = answers[questions[currentQuestion].id] !== undefined;
            nextBtn.disabled = !currentAnswered;
            
            if (currentQuestion === questions.length - 1 && currentAnswered) {
                nextBtn.textContent = 'Complete';
            } else {
                nextBtn.textContent = 'Next';
            }
        }
        
        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                showQuestion(currentQuestion + 1);
            } else {
                document.getElementById('quizScreen').classList.add('hidden');
                document.getElementById('emailScreen').classList.remove('hidden');
            }
        }
        
        function previousQuestion() {
            if (currentQuestion > 0) {
                showQuestion(currentQuestion - 1);
            }
        }
        
        async function submitEmail(event) {
            event.preventDefault();
            
            userData.name = document.getElementById('userName').value;
            userData.email = document.getElementById('userEmail').value;
            userData.emailConsent = document.getElementById('emailConsent').checked;
            
            const submitBtn = event.target.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Saving...';
            
            try {
                const response = await fetch('/.netlify/functions/submit-quiz', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: userData.name,
                        email: userData.email,
                        emailConsent: userData.emailConsent,
                        answers: answers
                    })
                });
                
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || 'Failed to submit quiz');
                }
                
                console.log('Quiz saved successfully:', result);
                
                calculateResults();
                document.getElementById('emailScreen').classList.add('hidden');
                document.getElementById('resultsScreen').classList.remove('hidden');
                
            } catch (error) {
                console.error('Error submitting quiz:', error);
                alert('There was an error saving your results. Please try again.');
                submitBtn.disabled = false;
                submitBtn.textContent = 'View My Results';
            }
        }
        
        function calculateResults() {
            let lowestScore = 5;
            let primaryConstraintId = null;
            
            questions.forEach(q => {
                const score = answers[q.id];
                if (score < lowestScore) {
                    lowestScore = score;
                    primaryConstraintId = q.id;
                }
            });
            
            const primaryConstraint = questions.find(q => q.id === primaryConstraintId);
            
            document.getElementById('primaryConstraint').textContent = `Your Primary Constraint: ${primaryConstraint.category}`;
            document.getElementById('constraintDescription').textContent = `Based on your responses, ${primaryConstraint.category.toLowerCase()} is the biggest bottleneck limiting your business growth right now.`;
            
            let scoresHtml = '';
            questions.forEach(q => {
                const score = answers[q.id];
                scoresHtml += `
                    <div class="score-item">
                        <span class="score-label">${q.category}</span>
                        <span class="score-value">${score}/5</span>
                    </div>
                `;
            });
            document.getElementById('scoresSummary').innerHTML = scoresHtml;
            
            const recommendations = getRecommendations(primaryConstraintId, lowestScore);
            document.getElementById('recommendationsText').innerHTML = recommendations;
        }
        
        function getRecommendations(constraintId, score) {
            const rec = quizConfig.recommendations[constraintId];
            
            if (!rec) {
                return '<p>Focus on improving this area to unlock your business growth.</p>';
            }
            
            return `
                <p><strong>${rec.description}</strong></p>
                <p><strong>Quick wins:</strong> ${rec.quickWins}</p>
                <p><strong>Next level:</strong> ${rec.nextLevel}</p>
            `;
        }
        
        function resetQuiz() {
            currentQuestion = 0;
            answers = {};
            userData = {};
            
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            document.getElementById('emailForm').reset();
            
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('introScreen').classList.remove('hidden');
        }
    </script>
</body>
</html>